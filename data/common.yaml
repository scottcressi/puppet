---
classes:
  - motd

resource_tree::collections:
  base-logs:
    filebeat::input:
      syslogs:
        paths: [
          '/var/log/secure',
        ]
  base-packages:
    package:
      telegraf:
         ensure: installed
         source: https://dl.influxdata.com/telegraf/releases/telegraf-1.15.2-1.x86_64.rpm
    service:
      telegraf:
        ensure: running
        require: package[telegraf]
    file:
      /etc/telegraf/telegraf.conf:
        require: package[telegraf]
        notify: service[telegraf]
        content: |
                 [agent]
                   hostname = "%{virtual}-%{role}-%{hostname}"
                   omit_hostname = false
                   interval = "5s"
                 [[outputs.influxdb]]
                   urls = ["http://%{hiera('influxdb')}:8086"]
                   database = "telegraf"
                 [[inputs.bond]]
                 [[inputs.cgroup]]
                 [[inputs.conntrack]]
                 [[inputs.cpu]]
                   percpu = true
                   totalcpu = true
                 [[inputs.disk]]
                 [[inputs.diskio]]
                 [[inputs.dns_query]]
                   servers = ["192.168.1.1"]
                 [[inputs.ethtool]]
                 [[inputs.hddtemp]]
                   address = "hddtemp:7634"
                 [[inputs.influxdb]]
                   urls = ["http://%{hiera('influxdb')}:8086/debug/vars"]
                 [[inputs.internal]]
                   collect_memstats = true
                 [[inputs.interrupts]]
                 [[inputs.iptables]]
                 [[inputs.ipvs]]
                 [[inputs.kernel]]
                 [[inputs.kernel_vmstat]]
                 [[inputs.linux_sysctl_fs]]
                 [[inputs.mem]]
                 [[inputs.net]]
                 [[inputs.netstat]]
                 [[inputs.nstat]]
                 [[inputs.ping]]
                   urls = ["192.168.1.1"]
                 [[inputs.processes]]
                 [[inputs.sensors]]
                 [[inputs.swap]]
                 [[inputs.syslog]]
                   server = "tcp://:6514"
                 [[inputs.system]]
                 [[inputs.temp]]
                 [[inputs.wireless]]

# company
company: 'example'

# puppet agent
puppet_agent::package_version: '6.18.0'
puppet_agent::service_names: ['puppet']
puppet_agent::collection: 'puppet6'

# SSH
ssh::server_options:
  PrintMotd: 'yes'
  Ciphers:
    'aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,chacha20-poly1305@openssh.com'
  MACs:
    'hmac-sha1-etm@openssh.com,umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-ripemd160-etm@openssh.com,hmac-sha1,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-ripemd160'
ssh::storeconfigs_enabled: false

# selinux
selinux::mode: 'permissive'

# filebeat
filebeat::outputs:
  logstash:
    hosts: ['%{hiera("elk_logstash")}:5044']
# filebeat
filebeat::logging:
  level: warning
filebeat::major_version: '7'
filebeat::package_ensure: '7.9.0'
filebeat::service_provider: 'systemd'

# telegraf
influxdb: localhost
